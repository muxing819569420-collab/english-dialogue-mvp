<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è‹±è¯­æƒ…æ™¯å­¦ä¹  - æ°‘å®¿é—²èŠ</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .page { width: 100%; max-width: 450px; display: none; position: relative; }
        .page.active { display: block; }
        .card { background: white; border-radius: 24px; padding: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.15); text-align: center; }
        /* è¿”å›æŒ‰é’®æ ·å¼ - å›ºå®šåœ¨å·¦ä¸Šè§’ */
        #backBtn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(107, 114, 128, 0.8);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 6px 12px;
            font-size: 13px;
            cursor: pointer;
            z-index: 10;
            transition: background 0.2s ease;
        }
        #backBtn:hover { background: #4b5563; }
        h1 { color: #2d3748; font-size: 1.8rem; margin-bottom: 10px; margin-top: 10px; }
        .description { color: #718096; margin-bottom: 40px; line-height: 1.5; }
        .mode-button { display: block; width: 100%; padding: 22px; margin: 16px 0; font-size: 18px; font-weight: 600; border: none; border-radius: 16px; cursor: pointer; transition: all 0.3s ease; color: white; }
        #modeAll { background: linear-gradient(to right, #10b981, #34d399); }
        #modeAll:hover { background: linear-gradient(to right, #0da271, #2bc288); }
        #modeOne { background: linear-gradient(to right, #3b82f6, #60a5fa); }
        #modeOne:hover { background: linear-gradient(to right, #2563eb, #4f8ef7); }
        .sentence-container { min-height: 260px; display: flex; flex-direction: column; justify-content: space-between; margin: 25px 0; padding: 25px; background: #f8f9ff; border-radius: 20px; border: 2px dashed #e0e5ff; }
        #currentSentence { font-size: 26px; line-height: 1.5; color: #1f2937; font-weight: 600; word-break: break-word; }
        .player-controls { display: flex; flex-direction: column; gap: 18px; width: 100%; }
        .main-controls { display: flex; gap: 15px; }
        .main-controls button { flex: 1; }
        button:not(#backBtn) { padding: 18px; font-size: 17px; font-weight: 600; border: none; border-radius: 14px; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; gap: 10px; }
        #playPauseBtn { background: #4f46e5; color: white; }
        #playPauseBtn:hover { background: #4338ca; }
        #nextBtn { background: #10b981; color: white; }
        #nextBtn:hover { background: #0da271; }
        /* ç®€åŒ–åçš„è¿›åº¦æŒ‡ç¤ºå™¨ */
        .progress { color: #6b7280; font-size: 16px; font-weight: 500; margin: 15px 0; }
        .hint { color: #9ca3af; font-size: 14px; margin-top: 20px; font-style: italic; }
    </style>
</head>
<body>
    <!-- æ–°å¢ï¼šè¯¾ç¨‹é€‰æ‹©é¡µé¢ -->
<div id="courseSelectionPage" class="page active">
    <div class="card">
        <h1>ğŸ“š é€‰æ‹©å­¦ä¹ ä¸»é¢˜</h1>
        <p class="description">è¯·é€‰æ‹©ä¸€ä¸ªæƒ…æ™¯å¯¹è¯å¼€å§‹å­¦ä¹ ã€‚</p>
        <!-- è¯¾ç¨‹å¡ç‰‡å°†åŠ¨æ€æ’å…¥åˆ°è¿™é‡Œ -->
        <div id="courseSelectionContainer"></div>
    </div>
</div>

<!-- ä¿®æ”¹ï¼šåŸå…¥å£é¡µæ”¹ä¸ºâ€œæ¨¡å¼é€‰æ‹©é¡µâ€ï¼Œåˆå§‹ä¸æ˜¾ç¤º -->
<div id="modeSelectionPage" class="page">
    <div class="card">
        <!-- æ³¨æ„ï¼šè¿™é‡Œçš„æ ‡é¢˜å’Œæè¿°éœ€è¦èƒ½åŠ¨æ€æ›´æ–° -->
        <h1 id="courseTitle">ğŸ¡ æ°‘å®¿åˆé‡</h1>
        <p id="courseDescription" class="description">æè¿°åŠ è½½ä¸­...</p>
        <button id="modeAll" class="mode-button">ğŸ§ å…¨éƒ¨æ’­æ”¾</button>
        <button id="modeOne" class="mode-button">ğŸ”Š é€å¥æ’­æ”¾</button>
        <button onclick="switchPage('courseSelectionPage')" class="mode-button" style="background:#6b7280;">â† è¿”å›è¯¾ç¨‹åˆ—è¡¨</button>
    </div>
</div>
    
    <!-- æ’­æ”¾é¡µé¢ï¼šå†…å®¹å­¦ä¹  -->
    <div id="playPage" class="page">
        <!-- è¿”å›æŒ‰é’®æ”¾åœ¨æ’­æ”¾é¡µé¢çš„å·¦ä¸Šè§’ -->
        <button id="backBtn">â† è¿”å›</button>
        <div class="card">
            <!-- ä¿®æ”¹ï¼šä¸ºæ ‡é¢˜å¢åŠ IDï¼Œä»¥ä¾¿åŠ¨æ€æ›´æ–° -->
            <h2 id="playPageTitle">æƒ…æ™¯å¯¹è¯ï¼šæ°‘å®¿é—²èŠ</h2>
            <div class="sentence-container">
                <div id="currentSentence">æ­£åœ¨åŠ è½½å¥å­...</div>
                <div class="player-controls">
                    <div class="main-controls">
                        <button id="playPauseBtn">â–¶ æ’­æ”¾</button>
                        <button id="nextBtn">ä¸‹ä¸€å¥ â¡</button>
                    </div>
                    <!-- ç®€åŒ–çš„è¿›åº¦æ˜¾ç¤º -->
                    <div class="progress"><span id="currentIndex">1</span>/<span id="totalSentences">10</span></div>
                </div>
            </div>
            <p class="hint" id="modeHint">ğŸ’¡ æç¤ºï¼šæ ¹æ®æ‚¨é€‰æ‹©çš„æ¨¡å¼ï¼Œæ’­æ”¾é€»è¾‘ä¼šæœ‰æ‰€ä¸åŒã€‚</p>
        </div>
    </div>

    <script>
// ============== å…¨å±€çŠ¶æ€ä¸åˆå§‹åŒ– ==============
let courseLibrary = [];
let currentCourse = null;
let currentDialogue = []; // å½“å‰è¯¾ç¨‹çš„å¯¹è¯æ•°ç»„
let currentMode = null;
let currentIndex = 0;
let currentAudio = null;
let isPlaying = false;
let playPageTitle = ""; // æ–°å¢ï¼šç”¨äºå­˜å‚¨æ’­æ”¾é¡µæ ‡é¢˜

// DOM å…ƒç´ 
const courseSelectionPage = document.getElementById('courseSelectionPage');
const modeSelectionPage = document.getElementById('modeSelectionPage');
const playPage = document.getElementById('playPage');
const courseSelectionContainer = document.getElementById('courseSelectionContainer');
const courseTitleEl = document.getElementById('courseTitle');
const courseDescriptionEl = document.getElementById('courseDescription');
const currentSentenceEl = document.getElementById('currentSentence');
const currentIndexEl = document.getElementById('currentIndex');
const totalSentencesEl = document.getElementById('totalSentences');
const playPauseBtn = document.getElementById('playPauseBtn');
const nextBtn = document.getElementById('nextBtn');
const backBtn = document.getElementById('backBtn');
const modeHint = document.getElementById('modeHint');
const modeAllBtn = document.getElementById('modeAll');
const modeOneBtn = document.getElementById('modeOne');

// ============== è¯¾ç¨‹åŠ è½½ä¸é€‰æ‹© ==============
async function loadCourses() {
    try {
        const response = await fetch('courses.json');
        const data = await response.json();
        courseLibrary = data.courses;
        renderCourseSelection();
    } catch (error) {
        console.error('åŠ è½½è¯¾ç¨‹å¤±è´¥:', error);
        courseSelectionContainer.innerHTML = '<p style="color:#ef4444;">è¯¾ç¨‹åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•ã€‚</p>';
    }
}

function renderCourseSelection() {
    courseSelectionContainer.innerHTML = '';
    courseLibrary.forEach(course => {
        const courseCard = document.createElement('div');
        courseCard.className = 'course-card';
        courseCard.style = 'border: 2px dashed #e0e5ff; border-radius: 16px; padding: 20px; margin: 15px 0; cursor: pointer; background: #f8f9ff; transition: all 0.2s;';
        courseCard.innerHTML = `
            <div style="font-size: 2.5rem; margin-bottom: 10px;">${course.icon}</div>
            <h3 style="margin: 5px 0; color: #1f2937;">${course.title}</h3>
            <p style="color: #6b7280; font-size: 0.95rem; margin-bottom: 10px;">${course.description}</p>
            <div style="font-size: 0.8rem; color: #9ca3af;">
                <span>${course.scenario}</span> â€¢ <span>${course.level}</span>
            </div>
        `;
        courseCard.onclick = () => selectCourse(course.id);
        courseCard.onmouseover = () => courseCard.style.backgroundColor = '#e0e7ff';
        courseCard.onmouseout = () => courseCard.style.backgroundColor = '#f8f9ff';
        courseSelectionContainer.appendChild(courseCard);
    });
}

function selectCourse(courseId) {
    currentCourse = courseLibrary.find(c => c.id === courseId);
    if (!currentCourse) return;
    
    currentDialogue = currentCourse.dialogue; // å…³é”®ï¼šè®¾ç½®å½“å‰å¯¹è¯
    currentIndex = 0; // é‡ç½®ç´¢å¼•
    
    // æ›´æ–°æ¨¡å¼é€‰æ‹©é¡µçš„è¯¾ç¨‹ä¿¡æ¯
    courseTitleEl.textContent = currentCourse.title;
    courseDescriptionEl.textContent = currentCourse.description;
    
    // æ–°å¢ï¼šè®¾ç½®æ’­æ”¾é¡µæ ‡é¢˜
    playPageTitle = `æƒ…æ™¯å¯¹è¯ï¼š${currentCourse.title}`;
    
    // åˆ‡æ¢åˆ°æ¨¡å¼é€‰æ‹©é¡µ
    switchPage('modeSelectionPage');
}

// ============== é¡µé¢å¯¼èˆª ==============
function switchPage(pageId) {
    // åœæ­¢å¯èƒ½æ­£åœ¨æ’­æ”¾çš„éŸ³é¢‘
    if (currentAudio && isPlaying) {
        currentAudio.pause();
        isPlaying = false;
    }
    
    // éšè—æ‰€æœ‰é¡µé¢
    document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
    });
    
    // æ˜¾ç¤ºç›®æ ‡é¡µé¢
    document.getElementById(pageId).classList.add('active');
}

// ============== æ’­æ”¾é€»è¾‘ (åŸºäº currentDialogue) ==============
function updatePlayPage() {
    if (!currentDialogue || currentDialogue.length === 0) {
        currentSentenceEl.textContent = 'å¯¹è¯å†…å®¹åŠ è½½é”™è¯¯ã€‚';
        return;
    }
    
    // æ–°å¢ï¼šæ›´æ–°æ’­æ”¾é¡µæ ‡é¢˜
    document.getElementById('playPageTitle').textContent = playPageTitle;
    
    currentSentenceEl.textContent = currentDialogue[currentIndex].text;
    currentIndexEl.textContent = currentIndex + 1;
    totalSentencesEl.textContent = currentDialogue.length;

    // æ›´æ–°æ¨¡å¼æç¤ºå’ŒæŒ‰é’®
    if (currentMode === 'all') {
        modeHint.textContent = 'ğŸ’¡ å…¨éƒ¨æ’­æ”¾æ¨¡å¼ï¼šå¯¹è¯å°†è‡ªåŠ¨è¿ç»­æ’­æ”¾ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ’­æ”¾/æš‚åœæŒ‰é’®æ§åˆ¶ã€‚';
        nextBtn.style.display = 'none';
    } else {
        modeHint.textContent = 'ğŸ’¡ é€å¥æ’­æ”¾æ¨¡å¼ï¼šç‚¹å‡»"æ’­æ”¾"æŒ‰é’®è†å¬å½“å‰å¥å­ï¼Œå®Œæˆåå¯æ‰‹åŠ¨é‡å¤æˆ–åˆ‡æ¢ä¸‹ä¸€å¥ã€‚';
        nextBtn.style.display = 'flex';
        
        // æ›´æ–°â€œä¸‹ä¸€å¥â€æŒ‰é’®çŠ¶æ€
        if (currentIndex === currentDialogue.length - 1) {
            nextBtn.textContent = 'ğŸ‰ å®Œæˆ';
            nextBtn.style.background = '#8b5cf6';
            nextBtn.onclick = () => { 
                alert(`æ­å–œï¼ä½ å·²ç»å­¦å®Œã€${currentCourse.title}ã€‘ã€‚`);
                switchPage('modeSelectionPage');
            };
        } else {
            nextBtn.textContent = 'ä¸‹ä¸€å¥ â¡';
            nextBtn.style.background = '#10b981';
            nextBtn.onclick = playNextSentence;
        }
    }
    updatePlayPauseButton();
}

function updatePlayPauseButton() {
    playPauseBtn.textContent = isPlaying ? 'â¸ï¸ æš‚åœ' : 'â–¶ æ’­æ”¾';
}

function playCurrentAudio() {
    if (!currentDialogue || !currentDialogue[currentIndex]) return;
    
    stopCurrentAudio();
    currentAudio = new Audio(currentDialogue[currentIndex].audioUrl);
    currentAudio.onended = handleAudioEnded;
    currentAudio.play();
    isPlaying = true;
    updatePlayPauseButton();
}

function stopCurrentAudio() {
    if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
        currentAudio.onended = null;
        isPlaying = false;
    }
}

function handleAudioEnded() {
    isPlaying = false;
    updatePlayPauseButton();
    
    // å…¨éƒ¨æ’­æ”¾æ¨¡å¼çš„è‡ªåŠ¨è¿æ’­é€»è¾‘
    if (currentMode === 'all') {
        if (currentIndex < currentDialogue.length - 1) {
            currentIndex++;
            updatePlayPage();
            setTimeout(playCurrentAudio, 300);
        } else {
            alert(`å®Œæ•´å¯¹è¯ã€${currentCourse.title}ã€‘æ’­æ”¾å®Œæ¯•ï¼`);
            switchPage('modeSelectionPage');
        }
    }
}

function playNextSentence() {
    if (currentIndex < currentDialogue.length - 1) {
        currentIndex++;
        updatePlayPage();
        if (currentMode === 'one') {
            setTimeout(playCurrentAudio, 300);
        }
    }
}

function togglePlayPause() {
    if (!currentAudio) {
        playCurrentAudio();
    } else if (isPlaying) {
        currentAudio.pause();
        isPlaying = false;
    } else {
        currentAudio.play();
        isPlaying = true;
    }
    updatePlayPauseButton();
}

// ============== äº‹ä»¶ç›‘å¬ ==============
// æ¨¡å¼é€‰æ‹©æŒ‰é’®
modeAllBtn.addEventListener('click', () => {
    currentMode = 'all';
    currentIndex = 0;
    switchPage('playPage');
    updatePlayPage();
    setTimeout(playCurrentAudio, 500);
});

modeOneBtn.addEventListener('click', () => {
    currentMode = 'one';
    currentIndex = 0;
    switchPage('playPage');
    updatePlayPage();
    setTimeout(playCurrentAudio, 500);
});

// æ’­æ”¾æ§åˆ¶æŒ‰é’®
playPauseBtn.addEventListener('click', togglePlayPause);
backBtn.addEventListener('click', () => switchPage('modeSelectionPage'));

// ============== åˆå§‹åŒ– ==============
// é¡µé¢åŠ è½½å®Œæˆåï¼Œè·å–è¯¾ç¨‹æ•°æ®
window.addEventListener('DOMContentLoaded', loadCourses);
</script>
</body>
</html>
