<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è‹±è¯­æƒ…æ™¯å­¦ä¹  - æ°‘å®¿é—²èŠ</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .page { width: 100%; max-width: 450px; display: none; position: relative; }
        .page.active { display: block; }
        .card { background: white; border-radius: 24px; padding: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.15); text-align: center; }
        /* è¿”å›æŒ‰é’®æ ·å¼ - å›ºå®šåœ¨å·¦ä¸Šè§’ */
        #backBtn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(107, 114, 128, 0.8);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 6px 12px;
            font-size: 13px;
            cursor: pointer;
            z-index: 10;
            transition: background 0.2s ease;
        }
        #backBtn:hover { background: #4b5563; }
        h1 { color: #2d3748; font-size: 1.8rem; margin-bottom: 10px; margin-top: 10px; }
        .description { color: #718096; margin-bottom: 40px; line-height: 1.5; }
        .mode-button { display: block; width: 100%; padding: 22px; margin: 16px 0; font-size: 18px; font-weight: 600; border: none; border-radius: 16px; cursor: pointer; transition: all 0.3s ease; color: white; }
        #modeAll { background: linear-gradient(to right, #10b981, #34d399); }
        #modeAll:hover { background: linear-gradient(to right, #0da271, #2bc288); }
        #modeOne { background: linear-gradient(to right, #3b82f6, #60a5fa); }
        #modeOne:hover { background: linear-gradient(to right, #2563eb, #4f8ef7); }
        .sentence-container { min-height: 260px; display: flex; flex-direction: column; justify-content: space-between; margin: 25px 0; padding: 25px; background: #f8f9ff; border-radius: 20px; border: 2px dashed #e0e5ff; }
        #currentSentence { font-size: 26px; line-height: 1.5; color: #1f2937; font-weight: 600; word-break: break-word; }
        .player-controls { display: flex; flex-direction: column; gap: 18px; width: 100%; }
        .main-controls { display: flex; gap: 15px; }
        .main-controls button { flex: 1; }
        button:not(#backBtn) { padding: 18px; font-size: 17px; font-weight: 600; border: none; border-radius: 14px; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; gap: 10px; }
        #playPauseBtn { background: #4f46e5; color: white; }
        #playPauseBtn:hover { background: #4338ca; }
        #nextBtn { background: #10b981; color: white; }
        #nextBtn:hover { background: #0da271; }
        /* ç®€åŒ–åçš„è¿›åº¦æŒ‡ç¤ºå™¨ */
        .progress { color: #6b7280; font-size: 16px; font-weight: 500; margin: 15px 0; }
        .hint { color: #9ca3af; font-size: 14px; margin-top: 20px; font-style: italic; }
    </style>
</head>
<body>
    <!-- å…¥å£é¡µé¢ï¼šæ¨¡å¼é€‰æ‹© -->
    <div id="entryPage" class="page active">
        <div class="card">
            <h1>ğŸ¡ æ°‘å®¿åˆé‡</h1>
            <p class="description">å…¥ä½æ°‘å®¿åï¼Œåœ¨å…¬å…±åŒºå’Œè€æ¿çš„è‡ªç„¶é—²èŠã€‚å­¦ä¹ å¦‚ä½•å¼€å¯å¯¹è¯ã€è¡¨è¾¾æ„Ÿå—å¹¶è·å–æœ¬åœ°æ¨èã€‚</p>
            <button id="modeAll" class="mode-button">ğŸ§ å…¨éƒ¨æ’­æ”¾ (è¿ç»­è†å¬å®Œæ•´å¯¹è¯)</button>
            <button id="modeOne" class="mode-button">ğŸ”Š é€å¥æ’­æ”¾ (ä¸“æ³¨å­¦ä¹ æ¯ä¸€å¥è¯)</button>
        </div>
    </div>

    <!-- æ’­æ”¾é¡µé¢ï¼šå†…å®¹å­¦ä¹  -->
    <div id="playPage" class="page">
        <!-- è¿”å›æŒ‰é’®æ”¾åœ¨æ’­æ”¾é¡µé¢çš„å·¦ä¸Šè§’ -->
        <button id="backBtn">â† è¿”å›</button>
        <div class="card">
            <h2>æƒ…æ™¯å¯¹è¯ï¼šæ°‘å®¿é—²èŠ</h2>
            <div class="sentence-container">
                <div id="currentSentence">æ­£åœ¨åŠ è½½å¥å­...</div>
                <div class="player-controls">
                    <div class="main-controls">
                        <button id="playPauseBtn">â–¶ æ’­æ”¾</button>
                        <button id="nextBtn">ä¸‹ä¸€å¥ â¡</button>
                    </div>
                    <!-- ç®€åŒ–çš„è¿›åº¦æ˜¾ç¤º -->
                    <div class="progress"><span id="currentIndex">1</span>/<span id="totalSentences">10</span></div>
                </div>
            </div>
            <p class="hint" id="modeHint">ğŸ’¡ æç¤ºï¼šæ ¹æ®æ‚¨é€‰æ‹©çš„æ¨¡å¼ï¼Œæ’­æ”¾é€»è¾‘ä¼šæœ‰æ‰€ä¸åŒã€‚</p>
        </div>
    </div>

    <script>
        // ============== æ ¸å¿ƒæ•°æ®ä¸çŠ¶æ€ ==============
        // ä½ åªéœ€è¦æ›¿æ¢ä¸‹é¢æ¯ä¸ªå¯¹è±¡ä¸­çš„ `audioUrl` ä¸ºçœŸå®çš„éŸ³é¢‘æ–‡ä»¶é“¾æ¥
        // çŠ¶æ€å˜é‡
let courseLibrary = []; // å…¨éƒ¨è¯¾ç¨‹
let currentCourse = null; // å½“å‰é€‰ä¸­è¯¾ç¨‹
let currentMode = null;
let currentIndex = 0;

// é¡µé¢åŠ è½½æ—¶è·å–è¯¾ç¨‹æ•°æ®
async function loadCourses() {
    try {
        const response = await fetch('courses.json');
        const data = await response.json();
        courseLibrary = data.courses;
        // æ¸²æŸ“è¯¾ç¨‹é€‰æ‹©èœå•
        renderCourseSelection();
    } catch (error) {
        console.error('åŠ è½½è¯¾ç¨‹å¤±è´¥:', error);
        // å¯ä»¥åœ¨è¿™é‡Œè®¾ç½®ä¸€ä¸ªé»˜è®¤çš„è¯¾ç¨‹ï¼Œæˆ–æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
    }
}

// æ¸²æŸ“è¯¾ç¨‹é€‰æ‹©ç•Œé¢
function renderCourseSelection() {
    const container = document.getElementById('courseSelectionContainer');
    // æ¸…ç©ºå®¹å™¨
    container.innerHTML = '';
    // åŠ¨æ€ç”Ÿæˆè¯¾ç¨‹å¡ç‰‡
    courseLibrary.forEach(course => {
        const courseCard = `
            <div class="course-card" onclick="selectCourse('${course.id}')">
                <div class="course-icon">${course.icon}</div>
                <h3>${course.title}</h3>
                <p>${course.description}</p>
                <div class="course-meta">
                    <span class="scenario">${course.scenario}</span>
                    <span class="level">${course.level}</span>
                </div>
            </div>
        `;
        container.innerHTML += courseCard;
    });
}

// é€‰æ‹©è¯¾ç¨‹
function selectCourse(courseId) {
    currentCourse = courseLibrary.find(c => c.id === courseId);
    // éšè—è¯¾ç¨‹é€‰æ‹©é¡µï¼Œæ˜¾ç¤ºä½ åŸæœ‰çš„â€œæ¨¡å¼é€‰æ‹©â€é¡µé¢
    // åŒæ—¶ï¼Œå°† currentCourse.dialogue èµ‹å€¼ç»™åŸæœ‰çš„æ’­æ”¾é€»è¾‘
    console.log('å·²é€‰æ‹©è¯¾ç¨‹:', currentCourse.title);
    // è¿™é‡Œéœ€è¦è°ƒç”¨ä½ å·²æœ‰çš„é¡µé¢åˆ‡æ¢å‡½æ•°
}
        // åº”ç”¨çŠ¶æ€
        let currentMode = null; // 'all' æˆ– 'one'
        let currentIndex = 0;
        let currentAudio = null;
        let isPlaying = false;

        // ============== DOM å…ƒç´  ==============
        const entryPage = document.getElementById('entryPage');
        const playPage = document.getElementById('playPage');
        const currentSentenceEl = document.getElementById('currentSentence');
        const currentIndexEl = document.getElementById('currentIndex');
        const totalSentencesEl = document.getElementById('totalSentences');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const nextBtn = document.getElementById('nextBtn');
        const backBtn = document.getElementById('backBtn');
        const modeHint = document.getElementById('modeHint');

        // ============== æ ¸å¿ƒåŠŸèƒ½å‡½æ•° ==============
        // åˆ‡æ¢é¡µé¢æ˜¾ç¤º
        function switchPage(toPageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(toPageId).classList.add('active');
        }

        // æ›´æ–°æ’­æ”¾é¡µé¢çš„æ˜¾ç¤ºï¼ˆå¥å­æ–‡æœ¬ã€è¿›åº¦ï¼‰
        function updatePlayPage() {
            currentSentenceEl.textContent = dialogue[currentIndex].text;
            // æ›´æ–°ä¸ºç®€åŒ–çš„è¿›åº¦æ˜¾ç¤ºæ ¼å¼ â€œ1/10â€
            currentIndexEl.textContent = currentIndex + 1;
            totalSentencesEl.textContent = dialogue.length;

            // æ ¹æ®æ¨¡å¼å’ŒçŠ¶æ€æ›´æ–°æŒ‰é’®æ–‡å­—å’Œæç¤º
            if (currentMode === 'all') {
                modeHint.textContent = 'ğŸ’¡ å…¨éƒ¨æ’­æ”¾æ¨¡å¼ï¼šå¯¹è¯å°†è‡ªåŠ¨è¿ç»­æ’­æ”¾ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ’­æ”¾/æš‚åœæŒ‰é’®æ§åˆ¶ã€‚';
                nextBtn.style.display = 'none';
            } else {
                modeHint.textContent = 'ğŸ’¡ é€å¥æ’­æ”¾æ¨¡å¼ï¼šæ¯æ¬¡æ’­æ”¾å½“å‰å¥å­ï¼Œå®Œæˆåå¯æ‰‹åŠ¨é‡å¤æˆ–åˆ‡æ¢ä¸‹ä¸€å¥ã€‚';
                nextBtn.style.display = 'flex';
                // å¦‚æœæ˜¯æœ€åä¸€å¥ï¼Œæ”¹å˜â€œä¸‹ä¸€å¥â€æŒ‰é’®çš„æ–‡æ¡ˆå’ŒçŠ¶æ€
                if (currentIndex === dialogue.length - 1) {
                    nextBtn.textContent = 'ğŸ‰ å®Œæˆ';
                    nextBtn.style.background = '#8b5cf6';
                    nextBtn.onclick = () => { alert('æ­å–œï¼ä½ å·²ç»å­¦å®Œæœ¬æ®µå¯¹è¯ã€‚'); };
                } else {
                    nextBtn.textContent = 'ä¸‹ä¸€å¥ â¡';
                    nextBtn.style.background = '#10b981';
                    nextBtn.onclick = playNextSentence;
                }
            }
            updatePlayPauseButton();
        }

        // æ›´æ–°æ’­æ”¾/æš‚åœæŒ‰é’®çš„æ˜¾ç¤º
        function updatePlayPauseButton() {
            playPauseBtn.textContent = isPlaying ? 'â¸ï¸ æš‚åœ' : 'â–¶ æ’­æ”¾';
        }

        // åŠ è½½å¹¶æ’­æ”¾å½“å‰å¥å­çš„éŸ³é¢‘
        function playCurrentAudio() {
            stopCurrentAudio();

            currentAudio = new Audio(dialogue[currentIndex].audioUrl);
            currentAudio.onended = handleAudioEnded;
            currentAudio.play();
            isPlaying = true;
            updatePlayPauseButton();
        }

        // åœæ­¢å½“å‰éŸ³é¢‘
        function stopCurrentAudio() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                currentAudio.onended = null;
                isPlaying = false;
            }
        }

        // å¤„ç†éŸ³é¢‘æ’­æ”¾ç»“æŸ
        function handleAudioEnded() {
            isPlaying = false;
            updatePlayPauseButton();

            if (currentMode === 'all') {
                if (currentIndex < dialogue.length - 1) {
                    currentIndex++;
                    updatePlayPage();
                    setTimeout(playCurrentAudio, 300);
                } else {
                    alert('å®Œæ•´å¯¹è¯æ’­æ”¾å®Œæ¯•ï¼');
                }
            }
        }

        // æ’­æ”¾ä¸‹ä¸€å¥ (ç”¨äºé€å¥æ’­æ”¾æ¨¡å¼)
        function playNextSentence() {
            if (currentIndex < dialogue.length - 1) {
                currentIndex++;
                updatePlayPage();
                if (currentMode === 'one') {
                    setTimeout(playCurrentAudio, 300);
                }
            }
        }

        // å¤„ç†æ’­æ”¾/æš‚åœæŒ‰é’®ç‚¹å‡»
        function togglePlayPause() {
            if (!currentAudio) {
                playCurrentAudio();
            } else if (isPlaying) {
                currentAudio.pause();
                isPlaying = false;
            } else {
                currentAudio.play();
                isPlaying = true;
            }
            updatePlayPauseButton();
        }

        // ============== äº‹ä»¶ç›‘å¬ä¸é¡µé¢åˆå§‹åŒ– ==============
        // æ¨¡å¼é€‰æ‹©æŒ‰é’®äº‹ä»¶
        document.getElementById('modeAll').addEventListener('click', () => {
            currentMode = 'all';
            currentIndex = 0;
            switchPage('playPage');
            updatePlayPage();
            setTimeout(playCurrentAudio, 500);
        });

        document.getElementById('modeOne').addEventListener('click', () => {
            currentMode = 'one';
            currentIndex = 0;
            switchPage('playPage');
            updatePlayPage();
            setTimeout(playCurrentAudio, 500);
        });

        // æ’­æ”¾æ§åˆ¶æŒ‰é’®äº‹ä»¶
        playPauseBtn.addEventListener('click', togglePlayPause);
        backBtn.addEventListener('click', () => {
            stopCurrentAudio();
            switchPage('entryPage');
        });

        // åˆå§‹åŒ–ï¼šè®¾ç½®æ€»å¥æ•°
        totalSentencesEl.textContent = dialogue.length;
    </script>
</body>
</html>
